- name: setup bridge
  hosts: myserver

  tasks:
  - name: delete wan0
    ansible.builtin.shell: |
      sudo nmcli con del wan0
    ignore_errors: true

  - name: delete lan0
    ansible.builtin.shell: |
      sudo nmcli con del lan0
    ignore_errors: true
  
  - name: delete br0
    ansible.builtin.shell: |
      sudo nmcli con del br0
    ignore_errors: true
      
  - name: create br0
    ansible.builtin.shell: |
      sudo nmcli con add \
        type bridge \
        ifname br0 \
        conn.id br0 \
        ipv4.method manual \
        ipv4.addresses 192.168.0.84/24 \
        ipv4.dns 192.168.0.1 \
        ipv4.gateway 192.168.0.1
  
  - name: create wan0
    ansible.builtin.shell: |
      sudo nmcli con add type ethernet ifname wan0 conn.id wan0 master br0

  - name: create lan0
    ansible.builtin.shell: |
      sudo nmcli con add type ethernet ifname lan0 conn.id lan0 master br0

