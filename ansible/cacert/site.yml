- name: install local CA
  hosts: noble

  tasks:
  - name: create directory for cacert
    ansible.builtin.file:
      path: /usr/local/share/ca-certificates/{{ caname }}
      state: directory
      owner: root
      group: root
      mode: '0755'
    when: |-
      ansible_facts['os_family'] == "Debian"

  - name: copy cacert
    ansible.builtin.copy:
      src: "{{ cacert }}"
      dest: /usr/local/share/ca-certificates/{{ caname }}
      owner: root
      group: root
      mode: '0644'
    when: |-
      ansible_facts['os_family'] == "Debian"

#  - name: add directory path to /etc/ca-certificates.conf
#    ansible.builtin.lineinfile:
#      path: /etc/ca-certificates.conf
#      line: "{{ caname }}/{{ cacert }}"
#      create: yes

  - name: update ca certificates
    ansible.builtin.shell: |
      update-ca-certificates
    when: |-
      ansible_facts['os_family'] == "Debian"

