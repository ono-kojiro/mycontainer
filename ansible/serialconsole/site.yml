- name:  enable serial console
  hosts: myserver

  tasks:
  - name: test
    ansible.builtin.lineinfile:
      path: /etc/default/grub
      regexp: '^GRUB_CMDLINE_LINUX='
      line: 'GRUB_CMDLINE_LINUX="console=tty0 console=ttyS0,19200n8"'
  
  - name: serial
    ansible.builtin.lineinfile:
      path: /etc/default/grub
      regexp: '^GRUB_TERMINAL='
      line: 'GRUB_TERMINAL=serial'

  - name: serial_command
    ansible.builtin.lineinfile:
      path: /etc/default/grub
      regexp: '^GRUB_SERIAL_COMMAND='
      line: 'GRUB_SERIAL_COMMAND="serial --speed=19200 --unit=0 --word=8 --parity=no --stop=1"'


  - name: update-grub
    ansible.builtin.shell: |
      update-grub



